# Telegram Bot for Google Drive

## Описание

Данный бот каждый день в заданное время отправляет напоминание о необходимости пройти проверку. Далее бот по очереди запрашивает фотографию объекта. После сбора всех фотографий он создает папку на Google Drive и кладет туда все собранные фотографии пользователя.

## Основные функции и возможности

- Ежедневное напоминание о необходимости пройти проверку.
- Запрос и сбор фотографий от пользователя в соответствии с его ролью.
- Создание папки на Google Drive для хранения собранных фотографий для каждого отдельного пользователя.
- Создание папки с новой датой на Google Drive для хранения собранных фотографий.
- Автоматическая загрузка фотографий на Google Drive в папку пользователя под конкретную дату.
- Автоматическая очистка фотографий старше выставленного параметра даты.

## Требования

- Node.js > 14.21.3
- Google Drive API, настроенный и включенный в вашем проекте Google Cloud
- PostgreSQL, настроенный и запущенный

## Инструкции по установке

1. **Клонирование репозитория**
    ```sh
    git clone https://github.com/Original-pokemon/telegramBotGoogleDrive.git
    cd telegrambotgoogledrive
    ```

2. **Установка зависимостей**
    ```sh
    npm install
    ```

3. **Настройка Google Drive API**
    1. Перейдите на [Google Cloud Console](https://console.cloud.google.com/).
    2. Создайте новый проект.
    3. Включите Google Drive API для вашего проекта.
    4. Перейдите в раздел "IAM & Admin" > "Service Accounts" и создайте сервисный аккаунт.
    5. Сгенерируйте ключ в формате JSON и скачайте его.
    6. Убедитесь, что JSON-файл с ключом доступен вашему приложению через переменную окружения `GOOGLE_APPLICATION_CREDENTIALS`.
    7. Предоставьте сервисному аккаунту доступ к папке, в которой будет работать бот (`MAIN_FOLDER_ID`):
    - Зайдите в Google Drive и найдите папку.
    - Нажмите правой кнопкой мыши на папку и выберите "Открыть доступ".
    - Введите email сервисного аккаунта и выберите уровень доступа ("Редактор").

4. **Настройка Telegram Bot**
    - Перейдите в Telegram и найдите BotFather.
    - Создайте нового бота и получите токен.
    - Сохраните токен в файл `.env` в корне проекта:
    ```env
    BOT_TOKEN=your_telegram_token_here
    ```

5. **Настройка переменных окружения**
    Добавьте в файл `.env` следующие переменные окружения:
    ```env
    DATABASE_URL=''           # Ссылка для подключения к базе данных PostgreSQL в формате postgres://PG_USER:PG_PASSWORD@PG_HOST:PG_PORT/
    MAIN_ADMIN_ID=''         # Telegram ID основного администратора бота
    MAIN_FOLDER_ID=''        # ID папки Google Drive, где будут сохраняться файлы
    GOOGLE_APPLICATION_CREDENTIALS='' # Путь к JSON-файлу с ключами сервисного аккаунта
    ```

6. **Запуск бота**
    ```sh
    npm start
    ```

7. **Авторизация в Google Drive**
    - При первом запуске перейдите по ссылке, которая появится в терминале, чтобы авторизовать доступ к вашему Google Drive.
    - Скопируйте код авторизации из открывшейся страницы и вставьте его в терминал.

## Структура проекта

```plaintext
telegrambotgoogledrive/
│
├── src/
│   ├── bot/
│   │   ├── features/
│   │   ├── middleware/
│   │   ├── repositories/
│   │   └── services/
│   ├── google-drive/
│   │   └── init-google-drive.js
│   ├── postgres-node/
│   │   ├── config.js
│   │   ├── const.js
│   │   └── init-base.js
│   ├── config.js
│   ├── const.js
│   ├── logger.js
│   └── main.js
```

## Описание директорий и файлов

- src/bot/: Содержит основные модули бота, такие как функции (features), middleware, репозитории и сервисы.
- src/google-drive/: Отвечает за интеграцию с Google Drive.
- middleware/: Содержит middleware для аутентификации и измерения времени ответа.
- src/postgres-node/: Содержит конфигурации и модули для работы с PostgreSQL.
- src/config.js: Файл конфигурации приложения.
- src/main.js: Главный файл для запуска приложения.
